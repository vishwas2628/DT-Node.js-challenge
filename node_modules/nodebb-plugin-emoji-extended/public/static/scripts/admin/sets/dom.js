"use strict";define("plugin/emoji-extended/admin/sets/container",["plugin/emoji-extended/debug","plugin/emoji-extended/admin/sets/data","plugin/emoji-extended/admin/sets/actions","plugin/emoji-extended/admin/sets/options"],function(a,b,c,d){/*=================================================== Functions  ===================================================*/
/*------------------------------------------------- attach actions -------------------------------------------------*/
function e(){w.find(".available-set-container").each(g),x.find(".install-set-container").each(h)}function f(a,b){var c=$(b),e=c.data("set-id"),f=o(e);return d.reset(c,f),c.find(".set-deactivate").removeAttr("disabled").click(function(a){B($(a.target),f)}),c.find(".set-options-save").removeAttr("disabled").click(function(a){C(c,$(a.target),f)}),c.find(".set-options-reset").removeAttr("disabled").click(function(a){D(c,$(a.target),f)}),c.find(".set-options-purge").removeAttr("disabled").click(function(a){E(c,$(a.target),f)}),c}function g(a,b){var c=$(b),d=c.data("set-id"),e=o(d);
// TODO add uninstall action
return c.find(".set-update").removeAttr("disabled").click(function(a){z($(a.target),e)}),c.find(".set-activate").click(function(a){A($(a.target),e)}),c.find(".set-purge").click(function(a){y($(a.target),e)}),e.prepared&&c.find(".set-activate,.set-purge").removeAttr("disabled"),c}function h(a,b){var c=$(b);
// TODO add install action
return c}/*---------------------------------------------------- actions  ----------------------------------------------------*/
//--- options
function i(a){return function(b,c,d){return s[d.id]?void 0:(p(c,d),a(b,d).always(function(){q(c,d)}))}}
//--- files
function j(a,b){return function(c,d){return!s[d.id]&&a(d)?(p(c,d),b(d).always(function(){q(c,d)})):void 0}}
//--- active sets
function k(a,b){return function(c,d){return!s[d.id]&&a(d)?(p(c,d),b(d).then(l).always(function(){q(c,d)})):void 0}}function l(a){return w.find(".set-container.hidden").each(function(a,b){$(b).removeClass("hidden")}),m(),a}/*------------------------------------------------ container switch ------------------------------------------------*/
function m(){if(v.children().remove(),!b.active.length)return u.addClass("hidden");for(var a=0;a<b.active.length;a++){var c=b.active[a];w.find('.set-container[data-set-id="'+c+'"]').addClass("hidden"),v.append(n(a,o(c)))}u.removeClass("hidden")}function n(a,b){var c=t.clone().attr("data-set-id",b.id);return c.find(".description").html(b.description||""),c.find(".active-set-heading").html(b.name+" <small>"+b.module+"</small>"),b.preview?(c.find(".preview-block > img").attr("src",b.preview),c.find(".description-container").addClass("col-sm-7"),c.find(".description").removeClass("no-margin-bottom")):c.find(".preview-container").remove(),b["static"]?c.find(".update-container").remove():c.find(".set-update").removeAttr("disabled").click(function(a){z($(a.target),b)}),b.hasMapping?(c.find(".option-label-mapping").attr("for","emoji-extended-active-mapping-"+b.id),c.find(".option-mapping").attr("id","emoji-extended-active-mapping-"+b.id)):c.find(".options-mapping").remove(),c.find(".option-label-excludes").attr("for","emoji-extended-active-excludes-"+b.id),c.find(".option-excludes").attr("id","emoji-extended-active-excludes-"+b.id),f(a,c)}/*----------------------------------------------------- utils  -----------------------------------------------------*/
function o(a){for(var c=b.installed,d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}}function p(b,c){s[c.id]=!0,a.log(c.id,"[busy]");var d=b.find(".fa");d.data("restore-class",d.attr("class")).attr("class","fa fa-fw fa-spin fa-spinner"),$('.set-container[data-set-id="'+c.id+'"]').addClass("busy").find(".set-action").each(function(a,b){r($(b),!0)})}function q(b,d){var e=b.find(".fa");e.attr("class",e.data("restore-class")).removeData("restore-class");var f=c.mayActivate(d),g=c.mayPurge(d),h=c.mayDeactivate(d),i=c.mayUpdate(d),j=$('.set-container[data-set-id="'+d.id+'"]').removeClass("busy");j.find(".set-activate").each(function(a,b){r($(b),!f)}),j.find(".set-purge").each(function(a,b){r($(b),!g)}),j.find(".set-deactivate").each(function(a,b){r($(b),!h)}),j.find(".set-update").each(function(a,b){r($(b),!i)}),a.log(d.id,"[/busy]"),delete s[d.id]}function r(a,b){b?a.attr("disabled",""):a.removeAttr("disabled")}var s={},t=$("#active-set-template").find(".set-container"),u=$("#active-sets-section"),v=$("#active-sets-container"),w=$("#available-sets-container"),x=$("#install-sets-container"),y=j(c.mayPurge,c.purge),z=j(c.mayUpdate,c.update),A=k(c.mayActivate,c.activate),B=k(c.mayDeactivate,c.deactivate),C=i(d.save),D=i(d.reset),E=i(d.purge);/*==================================================== Exports  ====================================================*/
return{init:e,updateActive:m}});