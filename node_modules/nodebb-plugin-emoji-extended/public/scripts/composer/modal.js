"use strict";define("plugin/emoji-extended/composer/modal",["plugin/emoji-extended/debug","plugin/emoji-extended/items","plugin/emoji-extended/settings","plugin/emoji-extended/completion","composer/controls","translator"],function(a,b,c,d,e,f){/*=================================================== Functions  ===================================================*/
function g(){var b=$.Deferred();return a.log("modal requested"),f.translate("[[emojiExtended:modal.title]]",function(a){b.resolve(a)}),$.when(p,c,d,b).then(function(b,c,d,e){var f=$.Deferred(),g=bootbox.dialog({size:"large",title:e,message:i(b,c,d,f),onEscape:function(){f.reject()}});return g.addClass("emoji-extended-modal"),a.log("modal ready"),a.enabled&&(f=f.fail(function(b){a.log("modal dismissed",b)})),f.then(function(b){return a.log("modal success",b),g.modal("hide"),b})})}function h(a,b,c){return g().then(function(d){var f=":"+d.id+": ",g=c+f.length,h=b===c?g:b;e.updateTextareaSelection(a,c,c),e.insertIntoTextarea(a,f),e.updateTextareaSelection(a,h,g),$(a).trigger("input")})}function i(a,b,c,d){var e=j(a,b,c);return e.on("click",".emoji-link",function(){d.resolve($(this).data("item"))}),e}function j(a,b,c){var d=$('<div class="tabbable"></div>'),e=$('<ul class="nav nav-tabs" role="tablist"></ul>').appendTo(d),g=$('<div class="tab-content"></div>').appendTo(d);return $.each(a,function(a,b){var d=b.title,h=$('<a href="#emoji-'+d+'" data-toggle="tab" data-ajaxify="false">'+d+"</a>"),i=$("<li></li>").append(h).appendTo(e),j=k(b,c).addClass("tab-pane fade").appendTo(g);f.translate("[[emojiCategories:"+d+"]]",function(a){h.text(a)}),0===a&&(i.addClass("active"),j.addClass("active in"))}),l(e,g,b),d}function k(a,b){for(var c=$('<div id="emoji-'+a.title+'" class="emoji-container row"></div>'),d=a.items,e=0;e<d.length;e++){var f=d[e];$('<a class="emoji-link col-xs-6 col-md-3" title="'+f.id+'"></a>').append(b.getImg(f,"emoji-presentation")+" :"+f.id+":").data("item",f).appendTo(c)}return c}function l(a,b,c){var d=c.legal;if(d.length){var e=$('<a href="#emoji-legal" data-toggle="tab">Legal Information</a>');$("<li></li>").append(e).appendTo(a),m(d,c.sets>1).addClass("tab-pane fade").appendTo(b),f.translate("[[emojiExtended:modal.legal]]",function(a){e.text(a)})}}function m(a,b){var c=$('<div id="emoji-legal"></div>');b&&f.translate("[[emojiExtended:modal.legal.header]]",function(a){$("<p>"+a+"</p>").prependTo(c)});for(var d=0;d<a.length;d++)n(a[d],b).appendTo(c);return c}function n(a,b){var c=$('<div id="emoji-legal-'+a.setId+'" class="emoji-legal-container"></div>');if(b){var d=$('<div class="panel-heading">Images of the set \''+a.setId+"'</div>").appendTo(c);f.translate("[[emojiExtended:modal.legal.set.header,"+a.setId+"]]",function(a){d.html(a)})}var e,g=$("<div></div>").appendTo(c);if(null!=a.attribution){var h=$("<h4></h4>").appendTo(g);f.translate("[[emojiExtended:modal.legal.set.attribution]]",function(a){h.text(a)}),e=$('<p class="legal-attribution well well-sm"></p>').appendTo(g),e.append(a.attribution)}if(null!=a.license){var i=$("<h4></h4>").appendTo(g);f.translate("[[emojiExtended:modal.legal.set.license]]",function(a){i.text(a)}),e=$('<p class="legal-license well well-sm"></p>').appendTo(g),e.append(a.license)}return b&&(c.addClass("panel panel-default"),g.addClass("panel-body")),c}var o="others",p=$.Deferred();/*==================================================== Exports  ====================================================*/
/*================================================= Initialization =================================================*/
/*------------------------------------------------ Categorize items ------------------------------------------------*/
return b.then(function(b){var c=[],d={};$.each(b.list,function(a,b){var e=b.category||o;d.hasOwnProperty(e)?d[e].push(b):(d[e]=[b],c.push(e))}),c.sort(function(a,b){return a===o?1:b===o?-1:b>a?-1:1}),c=$.map(c,function(a){return{title:a,items:d[a]}}),a.log("categorization complete",c),p.resolve(c)},function(a){p.reject(a)}),{open:g,openAndInsert:h}});