"use strict";!function(){/*--------------------------------------------------- Functions  ---------------------------------------------------*/
function a(a,b){var d=b.element;d.data(c)||(null===f?
// completion is not yet ready, add ASAP
require(["plugin/emoji-extended/completion"],function(a){a.then(function(a){a.applyTo(d,b.options)})}):f!==!1&&(
// completion is ready, use NodeBB way of attachment
b.strategies.push(f.strategy),d.data(c,!0)))}var b=[],c="emoji-extended-strategy",d={zIndex:2e4,listPosition:function(a){return this.$el.css(this._applyPlacement(a)),this.$el.css("position","absolute"),this}},e=$(window),f=null;/*================================================= Initialization =================================================*/
// get completion module to local variable in order to perform synchronous actions later on if ready
require(["plugin/emoji-extended/completion"],function(a){a.then(function(a){f=a},function(){f=!1})}),
// attach handler to NodeBB events to modify auto-completion
e.on("composer:autocomplete:init",a),e.on("chat:autocomplete:init",a),/*=============================================== Module definition  ===============================================*/
define("plugin/emoji-extended/completion",["plugin/emoji-extended/debug","plugin/emoji-extended/items","plugin/emoji-extended/settings","plugin/emoji-extended/detection"],function(a,e,f,g){var h=$.Deferred();return $.when(e,f,g).then(function(e,f,g){function i(b,e){b instanceof $||(b=$(b)),b.data(c)||(null==e&&(e=d),a.log("apply text-completion",b,e),b.textcomplete([r.strategy],e),b.data(c,!0))}function j(a,b){if(!g.allowCompletion(a))return b([]);var c=a.match(/:([\w\d\+-]*)$/)[1].toLowerCase(),d=$.grep(e.list,function(a){if(-1!==a.id.indexOf(c))return!0;for(var b=a.aliases.length,d=0;b>d;d++)if(-1!==a.aliases[d].indexOf(c))return!0;return!1});
// stable sort by indexOf(matcher)
return $.each(d,function(a,b){b.idx=a}),d=d.sort(function(a,b){var d=a.id.indexOf(c),e=b.id.indexOf(c);return-1===d?-1===e?a.idx-b.idx:1:-1===e?-1:d-e||a.idx-b.idx}),b(d)}function k(a){for(var b=p[a.setId],c="",d=0;d<b.length;d++){var e=b[d];if("string"==typeof e)c+=e;else{var f=e.key;a.hasOwnProperty(f)?c+=e.encode?encodeURIComponent(a[f]):a[f]:e.fallback&&(c+=e.fallback)}}return c}function l(a,b){var c=o+(b?" "+b:"");a.hasOwnProperty("classes")&&(c+=" "+a.classes);var d='<img src="'+k(a)+'" class="'+c+'" data-set-id="'+a.setId+'" data-emoji-id="'+a.id+'"';return a.hasOwnProperty("width")&&(d+=' width="'+a.width+'"'),a.hasOwnProperty("height")&&(d+=' height="'+a.height+'"'),d+"/>"}function m(a){return l(a,"emoji-completion")+" "+a.id}var n=f.completion,o=f.classes,p=f.urls;if(!n.enabled)return a.log("completion disabled"),h.reject("Disabled via settings.");var q="^((([\\s\\S]*)("+n.prefix+")):[\\w\\d+-]{"+n.minChars+",})$";$.each(e.list,function(a,c){$.isArray(c.aliases)||(c.aliases=b)});var r={strategy:{match:new RegExp(q,"i"),search:j,replace:function(a){return"$2:"+a.id+": "},template:m,maxCount:n.maxLines,index:1},getImg:l,getPath:k,applyTo:i};h.resolve(r)},function(a){h.reject(a)}),h})}();